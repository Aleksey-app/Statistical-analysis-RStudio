library(XML)

# Функция для загрузки и преобразования данных с веб-страницы
load_and_convert_weather_data <- function(url) {
  tables <- readHTMLTable(url)  # Читаем таблицы с веб-страницы
  
  # Первая таблица содержит годы, а вторая - месячные данные и среднегодовые данные
  years <- tables[[1]][, 1]  # Годы из первой таблицы
  
  # Данные за год из второй таблицы (столбцы 1-9)
  monthly_data <- tables[[2]][, 1:9]
  
  # Преобразование только с1 по 9 столбцы второй таблицы
  monthly_data <- suppressWarnings(as.data.frame(lapply(monthly_data, as.numeric)))
  monthly_data[monthly_data > 999] <- NA
  
  # Фильтрация данных с 2015 по 2024 год
  start_index <- which(years == 2015)
  end_index <- which(years == 2024)
  years <- years[start_index:end_index]
  monthly_data <- monthly_data[start_index:end_index, ]
  
  return(data.frame(Year = years, Monthly_Data = monthly_data))
}

# Загрузка и преобразование данных города Дрезден 
Dresden_url <- "http://www.pogodaiklimat.ru/history/10488.htm"
Dresden_data <- load_and_convert_weather_data(Dresden_url)

# Объединение данных в одну таблицу 
weather_report <- Dresden_data$Year
for (i in 1:9) {
  weather_report <- cbind(weather_report, Dresden_data$Monthly_Data[, i])
}

# Переименование столбцов
colnames(weather_report) <- c("Year", "January", "February", "March", "April", "May", "June", "July", "August", "September")

# Вывод отчета
print(weather_report)
library(ggplot2)

# Создаем датафрейм с данными
data <- data.frame(
  Месяц = c(rep("Январь", 10), rep("Февраль", 10), rep("Март", 10), rep("Апрель", 10), rep("Май", 9), rep("Июнь", 9), rep("Июль", 9), rep("Август", 9), rep("Сентябрь", 9)),
  Значение = c(2.8, 0.6, -3.0, 3.9, 0.4, 3.1, 0.4, 2.8, 4.0, 1.3,
               1.6, 3.8, 2.7, -2.0, 3.9, 5.6, 0.5, 4.7, 3.0, 7.0,
               5.7, 4.4, 7.5, 1.9, 7.2, 5.3, 4.8, 5.1, 5.8, 8.2,
               8.7, 8.5, 7.8, 13.8, 10.8, 11.0, 6.3, 7.8, 7.6, 11.5,
               13.5, 14.7, 14.8, 17.1, 11.8, 12.1, 11.6, 15.7, 13.5,
               16.3, 18.2, 18.5, 18.5, 22.1, 18.1, 20.1, 19.8, 18.7,
               20.7, 19.5, 19.2, 21.2, 19.7, 19.3, 19.7, 19.9, 20.6,
               22.0, 18.4, 19.2, 21.8, 20.8, 21.2, 17.1, 21.0, 19.8,
               13.9, 17.6, 13.7, 16.2, 15.1, 15.9, 15.9, 13.7, 18.4)
)

# Построение диаграммы разброса без эффекта дрожания
ggplot(data, aes(x = Месяц, y = Значение)) +
  geom_point() +
  labs(title = "Диаграмма разброса без эффекта дрожания",
       x = "Месяц", y = "Значение") +
  theme_minimal()

# Построение диаграммы разброса с эффектом дрожания
ggplot(data, aes(x = Месяц, y = Значение)) +
  geom_point(position = position_jitter(width = 0.2, height = 0.2)) +
  labs(title = "Диаграмма разброса с эффектом дрожания",
       x = "Месяц", y = "Значение") +
  theme_minimal()
# Данные X и Y
X <- c(2.8, 0.6, -3.0, 3.9, 0.4, 3.1, 0.4, 2.8, 4.0, 1.3,
       1.6, 3.8, 2.7, -2.0, 3.9, 5.6, 0.5, 4.7, 3.0, 7.0,
       5.7, 4.4, 7.5, 1.9, 7.2, 5.3, 4.8, 5.1, 5.8, 8.2,
       8.7, 8.5, 7.8, 13.8, 10.8, 11.0, 6.3, 7.8, 7.6, 11.5,
       13.5, 14.7, 14.8, 17.1, 11.8, 12.1, 11.6, 15.7, 13.5,
       16.3, 18.2, 18.5, 18.5, 22.1, 18.1, 20.1, 19.8, 18.7,
       20.7, 19.5, 19.2, 21.2, 19.7, 19.3, 19.7, 19.9, 20.6,
       22.0, 18.4, 19.2, 21.8, 20.8, 21.2, 17.1, 21.0, 19.8,
       13.9, 17.6, 13.7, 16.2, 15.1, 15.9, 15.9, 13.7, 18.4)

Y <- c(2.8, 1.6, 5.7, 8.7, 13.5, 16.3, 20.7, 22.0, 13.9,
       0.6, 3.8, 4.4, 8.5, 14.7, 18.2, 19.5, 17.6, 17.6,
       -3.0, 2.7, 7.5, 7.8, 14.8, 18.5, 19.2, 19.2, 13.7,
       3.9, -2.0, 1.9, 13.8, 17.1, 18.5, 21.2, 21.8, 16.2,
       0.4, 3.9, 7.2, 10.8, 11.8, 22.1, 19.7, 20.8, 15.1,
       3.1, 5.6, 5.3, 11.0, 12.1, 18.1, 19.3, 21.2, 15.9,
       0.4, 0.5, 4.8, 6.3, 11.6, 20.1, 19.7, 17.1, 15.9,
       2.8, 4.7, 5.1, 7.8, 15.7, 19.8, 19.9, 21.0, 13.7,
       4.0, 3.0, 5.8, 7.6, 13.5, 18.7, 20.6, 19.8, 18.4)

# Удаление лишних значений
X <- X[1:81]
Y <- Y[1:81]

# Вычисление коэффициента корреляции
correlation_coefficient <- cor(X, Y)

# Вывод результатов
print(correlation_coefficient)

# Вычисление стандартной ошибки коэффициента корреляции
standard_error <- 1 / sqrt(length(X) - 3)

# Вычисление t-статистики
t_statistic <- correlation_coefficient / standard_error

# Вычисление p-value
p_value <- 2 * pt(abs(t_statistic), df = length(X) - 2, lower.tail = FALSE)

# Вывод результатов
cat("Статистика критерия Стьюдента:", t_statistic, "\n")
cat("p-value:", p_value, "\n")

# Создаем датафрейм с переменными X и Y
data <- data.frame(X = X, Y = Y)

# Вычисляем регрессионную модель
model <- lm(Y ~ X, data = data)

# Выводим результаты модели
summary(model)
# SST
SST <- sum((Y - mean(Y))^2)

# SSR
Y_pred <- predict(model)
SSR <- sum((Y_pred - mean(Y))^2)

# SSE
SSE <- sum(model$residuals^2)

# Вычисляем среднеквадратическую ошибку оценки (MSE)
MSE <- SSE / (length(Y) - 2)  # Принимаем 2 коэффициента модели

# Вычисляем коэффициент детерминации
R_squared <- 1 - SSE / SST

# Результаты
print(paste("SST:", SST))
print(paste("SSR:", SSR))
print(paste("SSE:", SSE))
print(paste("MSE:", MSE))
print(paste("R-squared:", R_squared))
# Оценка коэффициента наклона
b1 <- coef(model)["X"]

# Стандартная ошибка оценки коэффициента наклона
SE_b1 <- summary(model)$coefficients["X", "Std. Error"]

# Количество наблюдений
n <- length(Y)

# Критическое значение t-распределения для alpha = 0.1/2 (двухсторонний интервал)
t_critical <- qt(0.05 / 2, df = n - 2)

# Доверительный интервал для коэффициента наклона
CI_lower <- b1 - t_critical * SE_b1
CI_upper <- b1 + t_critical * SE_b1

# Вывод результатов
print(paste("90%-доверительный интервал для коэффициента наклона:", CI_lower, CI_upper))

# Проверка гипотезы о наличии линейной зависимости между X и Y
if (CI_lower < 0 && CI_upper > 0) {
  print("Гипотеза о наличии линейной зависимости между X и Y не отвергается.")
} else {
  print("Гипотеза о наличии линейной зависимости между X и Y отвергается.")
}
# Данные X и Y
X <- c(2.8, 0.6, -3.0, 3.9, 0.4, 3.1, 0.4, 2.8, 4.0, 1.3,
       1.6, 3.8, 2.7, -2.0, 3.9, 5.6, 0.5, 4.7, 3.0, 7.0,
       5.7, 4.4, 7.5, 1.9, 7.2, 5.3, 4.8, 5.1, 5.8, 8.2,
       8.7, 8.5, 7.8, 13.8, 10.8, 11.0, 6.3, 7.8, 7.6, 11.5,
       13.5, 14.7, 14.8, 17.1, 11.8, 12.1, 11.6, 15.7, 13.5,
       16.3, 18.2, 18.5, 18.5, 22.1, 18.1, 20.1, 19.8, 18.7,
       20.7, 19.5, 19.2, 21.2, 19.7, 19.3, 19.7, 19.9, 20.6,
       22.0, 18.4, 19.2, 21.8, 20.8, 21.2, 17.1, 21.0, 19.8,
       13.9, 17.6, 13.7, 16.2, 15.1, 15.9, 15.9, 13.7, 18.4)

Y <- c(2.8, 1.6, 5.7, 8.7, 13.5, 16.3, 20.7, 22.0, 13.9,
       0.6, 3.8, 4.4, 8.5, 14.7, 18.2, 19.5, 17.6, 17.6,
       -3.0, 2.7, 7.5, 7.8, 14.8, 18.5, 19.2, 19.2, 13.7,
       3.9, -2.0, 1.9, 13.8, 17.1, 18.5, 21.2, 21.8, 16.2,
       0.4, 3.9, 7.2, 10.8, 11.8, 22.1, 19.7, 20.8, 15.1,
       3.1, 5.6, 5.3, 11.0, 12.1, 18.1, 19.3, 21.2, 15.9,
       0.4, 0.5, 4.8, 6.3, 11.6, 20.1, 19.7, 17.1, 15.9,
       2.8, 4.7, 5.1, 7.8, 15.7, 19.8, 19.9, 21.0, 13.7,
       4.0, 3.0, 5.8, 7.6, 13.5, 18.7, 20.6, 19.8, 18.4)

# Удаление лишних значений
X <- X[1:81]
Y <- Y[1:81]

# Построение линии регрессии на диаграмме разброса
plot(X, Y, xlab = "X", ylab = "Y", main = "Диаграмма разброса с линией регрессии")
abline(lm(Y ~ X), col = "red")
